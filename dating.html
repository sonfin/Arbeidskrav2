<!DOCTYPE html>
<html lang="nb">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dating</title>
    <link rel="stylesheet" href="./dating-style.css">
</head>

<body>
    <header>
        <nav>
            <a href="./dating.html">
                <div class="nav-div dating">
                    <p>DATING</p>
                </div>
            </a>
            <a href="./dogcare.html">
                <div class="nav-div dog-care">
                    <p>DOG CARE</p>
                </div>
            </a>
        </nav>
    </header>

    <!-- Containeren for hele siden-->
    <div class="main-container">

        <!-- Container for kjønns knappene -->
        <div class="gender-container">
            <div class="side-buttons">
                <button id="kvinner-btn" data-gender="female">Kvinner</button>
                <button id="menn-btn" data-gender="male">Menn</button>
                <button id="begge-btn">Begge kjønn</button>
            </div>

            <p id="score">Score: <span id="score-value">10</span></p>

            <!-- Container for dating kortet i midten-->
            <div class="dating-card">
                <img src="" alt="Dating Bilde">
                <p id="navn">Navn</p>
                <p id="bosted">Bosted</p>
            </div>

            <!-- Container for matchede kort skal i teorien legge seg her-->
            <div class="matched-cards">
                <div class="image-grid">

                    <!--Her må det legges til flere bilder etter vi har koblet til API-->
                </div>
            </div>

        </div>

        <script>

            // score og liked profiles
            let score = 10;
            let likedProfiles = [];
            let currentProfile;
            let currentGenderFilter = '';

            //Funksjon for å endre border basert på kjønn - Denne funker ikke enda... Kløøøøør meg i hodet av den. 
            function setBorderStyles(profileCard, gender) {
                if (gender === 'male') {
                    profileCard.style.border = '4px solid #5f535c';
                } else if (gender === 'female') {
                    profileCard.style.border = '4px solid #a68582';
                } else {
                    profileCard.style.border = '';
                }
            }

            //Funksjon som oppdaterer visning av scoret
            function updateScoreDisplay() {
                const scoreDisplay = document.getElementById('score');
                scoreDisplay.textContent = score;
            }

            //Funksjon for å vise type profil i kortet
            function display(profile) {
                const profileCard = document.querySelector('.dating-card');
                profileCard.querySelector('img').src = profile.picture.large;
                profileCard.querySelector('#navn').textContent = `${profile.name.first} ${profile.name.last}`;
                profileCard.querySelector('#bosted').textContent = `${profile.location.city}, ${profile.location.country}`;

                setBorderStyles(profileCard, profile.gender);
            }

            //Funksjon for å hente og vise tilfeldig profil
            async function fetchRandomProfile(gender) {
                if (gender !== undefined) {
                    currentGenderFilter = gender;
                }

                const genderParam = currentGenderFilter ? `&gender=${currentGenderFilter}` : '';
                fetch("https://randomuser.me/api/?" + genderParam)
                    .then(response => response.json())
                    .then(data => {
                        const profile = data.results[0];
                        currentProfile = profile;
                        display(profile);
                    })
                    .catch(error => console.error('Error fetching random profile:', error));
            }





            //Funksjon for å bytte ut kortet med en ny profil
            function swipeLeft() {
                fetchRandomProfile();
            }

            //Funksjon for å legge til profilen i likte profiler
            function swipeRight(profile) {
                likedProfiles.push(profile);
                localStorage.setItem('likedProfiles', JSON.stringify(likedProfiles));
                score--;
                updateScoreDisplay();

                //Hvis brukeren har nådd maksimalt antall likte profiler
                if (likedProfiles.length > 10) {
                    alert('Du har likt for mange profiler.Vennligst slett noen profiler fra oversikten.');

                }
                //Hent og vis tilfeldig profil
                fetchRandomProfile();

            }
            // Funksjon for å vise likte profiler
            function renderLikedProfiles() {
                const likedProfilesList = document.getElementById('liked-profiles-list');
                likedProfilesList.innerHTML = ''; //tøm listen før oppdatering
                likedProfiles.forEach(profile => {
                    const li = document.createElement('li');
                    li.textContent = `${profile.name.first} ${profile.name.last}`;
                    //sletteknapp
                    const deleteButton = document.createElement('button');
                    deleteButton.addEventListener('click', () => deleteProfile(profile));
                    li.appendChild(deleteButton);
                    likedProfilesList.appendChild(li);

                });


            }

            //Slette profil fra likte profiler
            function deleteProfile(profile) {
                const index = likedProfiles.indexOf(profile);
                if (index !== -1) {
                    likedProfiles.splice(index, 1);
                    localStorage.setItem('likedProfiles', JSON.stringify(likedProfiles));
                    renderLikedProfiles();

                }
            }

            // Lyttere for tastatur
            document.addEventListener('keydown', (event) => {
                if (event.key === 'ArrowLeft') {
                    swipeLeft();
                    decreaseScore();

                } else if (event.key === 'ArrowRight') {
                    swipeRight(currentProfile); //?
checkScore();
                }
            })

            // Lyttere for filtreringsknapper
            document.getElementById('kvinner-btn').addEventListener('click', () => fetchRandomProfile('female'));
            document.getElementById('menn-btn').addEventListener('click', () => fetchRandomProfile('male'));
            document.getElementById('begge-btn').addEventListener('click', () => fetchRandomProfile(''));



            // Hent en tilfeldig profil når siden lastes
            fetchRandomProfile();

// Funksjon for å sjekke om brukeren er tom for poeng
function checkScore() {
    if (score <= 0) {
        let answer = false
        while (!answer) {
            answer = confirm('Har du lyst til å swipe mer? Ja/Nei');
            if (answer) {
                score = 10;
                updateScoreDisplay();
                break;
            }
        }
    }
}

//Funksjon for å oppdatere score-display
function updateScoreDisplay() {
    const scoreDisplay = document.getElementById('score-value');
    scoreDisplay.textContent = score;
}

//Redusere score-poeng
function decreaseScore() {
    score--;
    updateScoreDisplay();
    checkScore(); //sjekker om brukeren ikke har mer poeng
}
        </script>
</body>

</html>