<!DOCTYPE html>
<html lang="nb">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dogcare</title>
    <link rel="stylesheet" href="./dog-care.css" />
  </head>
  <style>
    /*Provisorisk styling, flyttes til stylesheet*/
    body {
      font-family: Arial, sans-serif;
      margin: 0px;
      background-image: url("dogcare-assets/background.jpg");
      background-repeat: no-repeat;
      background-size: cover;
    }
    #dog-care-cards {
      display: grid;
      grid: 1fr 1fr/ 1fr 1fr;
      place-content: center;
      gap: 40px;
      margin: 100px 150px;
    }
    .card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .image-container {
      width: 200px;
      height: 200px;
      overflow: hidden;
      border-radius: 8px;
    }
    .card {
      display: grid;
      grid-template-columns: repeat(2, auto);
      grid-template-rows: repeat(3, auto);
      place-content: center;
      gap: 10px;
      border: 2px solid rgb(255, 255, 255);
      border-radius: 8px;
      padding: 20px;
      /* From https://css.glass */
      background: rgba(255, 255, 255, 0.18);
      border-radius: 16px;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(15.6px);
      border: 1px solid rgba(255, 255, 255, 0.55);
      font-size: 14px;
    }
    .btn {
      padding: 10px;
      cursor: pointer;
      background-color: #ffffff;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    #show-new-cards-btn {
      position: sticky;
      top: 5px;
      left: 20px;
    }
    .dog-greeting-bubble {
        position: absolute;
        top: -10%;
        left: 80%;
        width: 20%; 
        height: 10%; 
        background: rgba(255, 255, 255, 0.9);
        border-radius: 8px;
        padding: 10px;
        box-shadow: 0px 2px 6px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        font-size: 13px;
      }

      .dog-icon {
        margin-right: 10px;
      }

      .dog-icon img {
        width: 20px;
        height: 20px;
      }
  </style>
  <body>
    <header>
      <nav>
        <a href="./dating.html"
          ><div class="nav-div dating"><p>Dating</p></div></a
        >
        <a href="./dogcare.html"
          ><div class="nav-div dog-care"><p>Dog-care</p></div></a
        >
      </nav>
    </header>
    <main>
      <button id="show-new-cards-btn" class="btn">Vis 10 nye kort</button>
      <div id="dog-care-cards"></div>
    </main>
    <footer>
      <img
        src="./dogcare-assets/test.jpg"
        alt="Testknapp"
        class="test-img"
        id="test-button"
      />
    </footer>
    <script>
      //Henter inn knapp og div til √• vise kort i
      let dogCareCards = document.getElementById("dog-care-cards");
      const showNewCardsBtn = document.getElementById("show-new-cards-btn");
      showNewCardsBtn.addEventListener("click", initializeDogsAndOwners);

      let dogs = [];
      let owners = [];

      //Funksjon for √• hente inn 10 random hunde bilder
      async function getDogs() {
        const dogsRequest = await fetch(
          "https://dog.ceo/api/breeds/image/random/10"
        );
        const dogsResult = await dogsRequest.json();
        return dogsResult.message;
      }

      //Funksjon for √• hente inn navn, lokasjon og bilde for 10 random brukere
      async function getOwners() {
        const ownersRequest = await fetch(
          "https://randomuser.me/api/?results=10&inc=name,location,picture"
        );
        const ownersResult = await ownersRequest.json();
        return ownersResult.results;
      }

      //Funksjon for √• legge inn date i globale variabler dogs og owners, samt error h√•ndtering
      async function initializeDogsAndOwners() {
        try {
          dogs = await getDogs();
          owners = await getOwners();
          displayDogsAndOwners();
        } catch (error) {
          console.error("Error med √• laste innhold", error);
        }
      }

      //Funksjon for √• lage kort med data fra dogs og owners
      function displayDogsAndOwners() {
        let cards = "";
        for (let index = 0; index < 10; index++) {
          const owner = owners[index];
          const dog = dogs[index];
          cards += `
        <div class="card">
          <div class="image-container">
            <img src="${dogs[index]}" alt="hund">
          </div>
          <div class="image-container">
            <img src="${owner.picture.large}" alt="eier">
          </div>
          <p>Eier: ${owner.name.first} ${owner.name.last}</p>
          <p>Bosted: ${owner.location.city}, ${owner.location.country}</p>
          <button id="delete-btn" class="btn" onclick="deleteCard(${index})">‚úñ Slett</button>
          <button id="chat-btn" class="btn">üí¨ Chat</button>
        </div>`;
        }
        dogCareCards.innerHTML = cards;

        // Event listener for hvert kort til dogGreeting
        const cardElements = document.querySelectorAll(".card");
        cardElements.forEach((card, index) => {
          card.addEventListener("click", () => dogGreeting(card));
        });
      }

      //Funksjon for √• hente inn nytt kort
      async function getNewDogAndOwner() {
        const newOwnerResult = await fetch("https://randomuser.me/api/");
        const newOwner = await newOwnerResult.json();

        const newDogResult = await fetch(
          "https://dog.ceo/api/breeds/image/random"
        );
        const newDog = await newDogResult.json();

        return {
          dog: newDog.message,
          owner: newOwner.results[0],
        };
      }

      //Funksjon for √• slette kort
      async function deleteCard(index) {
        dogs.splice(index, 1);
        owners.splice(index, 1);

        const { dog, owner } = await getNewDogAndOwner();

        dogs.push(dog);
        owners.push(owner);

        displayDogsAndOwners();
      }

      //Funksjon for √• laste inn nye kort
      async function showNewCards() {
        await initializeDogsAndOwners();
      }

      initializeDogsAndOwners();

      //oppgave 5.1
      const testBtn = document.getElementById("test-button");
      let chatBoxOpen = false;

      testBtn.onclick = chatBox;

      function chatBox() {
        chatBoxOpen = true;
        console.log(chatBoxOpen);
        console.log("Test 2");
      }

      //OPPGAVE 6 - funksjon for √• lage snakkeboble n√•r bruker trykker p√• kortet

      const dogSounds = [
        "Voff voff",
        "Grrr!",
        "Mjau??",
        "Voff!",
        "Voff voff voff",
        "WRAFF!!!",
      ];
      function dogGreeting(card) {
        if (event.target.id === "delete-btn" || event.target.id === "chat-btn") { //gj√∏r at funksjonen stopper hvis bruker klikker p√• sletteknappen og chatknappen
          return;
        }

        const existingBubble = card.querySelector(".dog-greeting-bubble");
        if (existingBubble) {
          existingBubble.remove();
        }

        const dogGreetingBubble = document.createElement("div");
        dogGreetingBubble.classList.add("dog-greeting-bubble");
        dogGreetingBubble.innerHTML = `
        <div class="dog-icon">
          <img src="/dogcare-assets/ dog-icon.png" alt="dog icon">
        </div>
        <div class="dog-greeting-text">
          <p>${dogSounds[Math.floor(Math.random() * dogSounds.length)]}</p>
        </div>
        `;
        card.appendChild(dogGreetingBubble);

        if (dogGreetingBubble) {
          dogGreetingBubble.addEventListener("click", (event) => {
            event.stopPropagation(); // gj√∏r at dogGreetingCard ikke trigges igjen https://www.w3schools.com/jsref/event_stoppropagation.asp
            dogGreetingBubble.remove();
          });
        }
      }

    </script>
  </body>
</html>
