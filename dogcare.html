<!DOCTYPE html>
<html lang="nb">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dogcare</title>
    <link rel="stylesheet" href="./dog-care.css" />
  </head>
  <body>
    <header>
      <nav>
        <a href="./dating.html"
          ><div class="nav-div dating"><p>Dating</p></div></a
        >
        <a href="./dogcare.html"
          ><div class="nav-div dog-care"><p>Dog-care</p></div></a
        >
      </nav>
    </header>
    <main>
      <button id="show-new-cards-btn" class="btn">Vis 10 nye kort</button>
      <div id="dog-care-cards"></div>

      <div class="chat-box">
        <div class="chat-name">
          <div class="img-div">
            <img
              src="./dogcare-assets/profile-photo.jpg"
              alt="Profilbilde"
              id="owner-picture"
            />
          </div>
          <div class="owner-info">
            <h1 id="owner-name">Test for styling</h1>
            <h2 id="owner-location">Chicago, Illinois</h2>
          </div>
          <img
            src="./dogcare-assets/close.png"
            alt="close chat button"
            id="close-button"
          />
        </div>
        <div class="chat-messages">
          <!-- <div class="messages"></div> -->
        </div>
        <div class="chat-text-section">
          <input
            type="text"
            placeholder="Skriv melding...."
            class="chat-text-input"
          />
          <input type="button" value="Send" class="chat-send-button" />
        </div>
      </div>
    </main>
    <footer></footer>
    <script>
      //Henter inn knapp og div til √• vise kort i
      let dogCareCards = document.getElementById("dog-care-cards");
      const showNewCardsBtn = document.getElementById("show-new-cards-btn");
      showNewCardsBtn.addEventListener("click", initializeDogsAndOwners);

      let dogs = [];
      let owners = [];

      //Funksjon for √• hente inn 10 random hunde bilder
      async function getDogs() {
        const dogsRequest = await fetch(
          "https://dog.ceo/api/breeds/image/random/10"
        );
        const dogsResult = await dogsRequest.json();
        return dogsResult.message;
      }

      //Funksjon for √• hente inn navn, lokasjon og bilde for 10 random brukere
      async function getOwners() {
        const ownersRequest = await fetch(
          "https://randomuser.me/api/?results=10&inc=name,location,picture"
        );
        const ownersResult = await ownersRequest.json();
        return ownersResult.results;
      }

      //Funksjon for √• legge inn date i globale variabler dogs og owners, samt error h√•ndtering
      async function initializeDogsAndOwners() {
        try {
          dogs = await getDogs();
          owners = await getOwners();
          displayDogsAndOwners();
        } catch (error) {
          console.error("Error med √• laste innhold", error);
        }
      }

      //Funksjon for √• lage kort med data fra dogs og owners
      function displayDogsAndOwners() {
        let cards = "";
        for (let index = 0; index < 10; index++) {
          const owner = owners[index];
          const dog = dogs[index];
          cards += `
        <div class="card">
          <div class="image-container">
            <img src="${dogs[index]}" alt="hund">
          </div>
          <div class="image-container">
            <img src="${owner.picture.large}" alt="eier">
          </div>
          <p>Eier: ${owner.name.first} ${owner.name.last}</p>
          <p>Bosted: ${owner.location.city}, ${owner.location.state}</p>
          <button id="delete-btn" class="btn" onclick="deleteCard(${index})">‚úñ Slett</button>
          <button id="chat-btn" class="btn" onclick="chatBox(${index})">üí¨ Chat</button>
        </div>`;
        }
        dogCareCards.innerHTML = cards;

        // Event listener for hvert kort til dogGreeting
        const cardElements = document.querySelectorAll(".card");
        cardElements.forEach((card, index) => {
          card.addEventListener("click", () => dogGreeting(card));
        });
      }

      //Funksjon for √• hente inn nytt kort
      async function getNewDogAndOwner() {
        const newOwnerResult = await fetch("https://randomuser.me/api/");
        const newOwner = await newOwnerResult.json();

        const newDogResult = await fetch(
          "https://dog.ceo/api/breeds/image/random"
        );
        const newDog = await newDogResult.json();

        return {
          dog: newDog.message,
          owner: newOwner.results[0],
        };
      }

      //Funksjon for √• slette kort
      async function deleteCard(index) {
        dogs.splice(index, 1);
        owners.splice(index, 1);

        const { dog, owner } = await getNewDogAndOwner();

        dogs.push(dog);
        owners.push(owner);

        displayDogsAndOwners();
      }

      //Funksjon for √• laste inn nye kort
      async function showNewCards() {
        await initializeDogsAndOwners();
      }

      initializeDogsAndOwners();

      //oppgave 5.1
      const closeBtn = document.getElementById("close-button");
      const ownerImg = document.getElementById("owner-picture");
      const ownerName = document.getElementById("owner-name");
      const chatTextInput = document.querySelector(".chat-text-input");
      const ownerLocation = document.getElementById("owner-location");
      let chatOpen = false;
      let firstText = true;

      closeBtn.onclick = closeChat;

      // Funksjon for √• √•pne chat
      function chatBox(index) {
        if (chatOpen) {
          console.log("Chat er √•pen fra f√∏r.");
          return;
        }
        const owner = owners[index];
        const dog = dogs[index];
        chatOpen = true;
        const chatDiv = document.querySelector(".chat-box");
        chatDiv.style.display = "flex";
        introMessage(owner.name.first);
        ownerImg.src = owner.picture.large;
        ownerImg.alt = "eier";
        ownerName.innerHTML = `${owner.name.first} ${owner.name.last}`;
        ownerLocation.innerHTML = `${owner.location.city}, ${owner.location.state}`;

        if (chatOpen === true) {
          const chatSendBtn = document.querySelector(".chat-send-button");
          chatTextInput.focus();
          chatSendBtn.addEventListener("click", sendMessage);
          chatTextInput.addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
              sendMessage();
              chatTextInput.value = "";
            }
          });
        }
      }
      // Funksjon for √• lukke chat.
      function closeChat() {
        chatOpen = false;
        const chatDiv = document.querySelector(".chat-box");
        chatDiv.style.display = "none";
        firstText = true;
        clearChat();
      }
      // Funksjon for √• motta f√∏rste melding fra Eier
      function introMessage(navn) {
        if (firstText === true) {
          const firstMessages = [
            ", og min trofaste f√∏lgesvenn er Charlie. Han er en nysgjerrig dachshund som alltid har nesen sin i alt!",
            ", og min livlige venn er Luna. En leken border collie som elsker √• hente ball og imponere med triks!",
            "! Min firbente venn, Rocky, er en sterk og kj√¶rlig bernese mountain dog. Han er like god som en kosebamse!",
            ", og min energibunt er Max, en glad golden retriever som sprer glede med hvert labbetrykk!",
            ", og min pelskledde venn er Daisy. Hun er en kj√¶rlig bichon frise som alltid f√•r folk til √• smile!",
            ", og min lille kompis er Bella, en lekfull chihuahua med et stort hjerte til tross for sin lille st√∏rrelse!",
            ", og min trofaste f√∏lgesvenn er Milo. Han er en eventyrlysten shiba inu som elsker √• utforske verden rundt seg!",
            ", og min beste venn er Coco, en sjarmerende fransk bulldog som alltid stjeler oppmerksomheten med sitt uttrykksfulle ansikt!",
            "! Min firbente kamerat er Bella, en leken labrador retriever som er like glad i lek som i godbiter!",
            "! Min lojale venn er Rocky, en robust rottweiler med et mykt hjerte. Han er den beste vaktbikkjen med en kj√¶rlig side!",
          ];
          const randomFirstMessage =
            firstMessages[Math.floor(Math.random() * firstMessages.length)];
          showMessages(
            `Hei, jeg heter ${navn}${randomFirstMessage}`,
            "received"
          );
        }
        firstText = false;
      }
      // Funksjon for √• sende melding
      function sendMessage() {
        const message = chatTextInput.value;
        if (message !== "") {
          showMessages(message, "sent");
          setTimeout(() => {
            promptResponse();
          }, 1000);
        }
      }
      // Funksjon for √• f√• et tilfeldig svar p√• melding
      function promptResponse() {
        const ownerResponses = [
          "Hunden min er en glede √• ha rundt! Han sprer alltid positiv energi og elsker √• leke i hagen.",
          "Favoritt triks? Han har virkelig mestret high-five, og vi jobber med √• l√¶re ham √• rulle over. Det er alltid g√∏y √• se ham i aksjon!",
          "For helgen planlegger vi lange turer i naturen, der han kan utforske og nyte frisk luft. Etterp√• blir det avslapping og kos for b√•de ham og meg.",
          "N√•r det gjelder filmer, virker det som om han virkelig liker 'Poted√•ren.' Jeg tror det er alle de morsomme dyrene som fanger oppmerksomheten hans!",
          "I trenings√∏ktene v√•re har han virkelig f√•tt taket p√• √• sitte og bli. Han er ogs√• en ekspert p√• √• motta godbiter med stil! Det er s√• g√∏y √• se fremgangen hans.",
          "N√•r det gjelder snacks, er han ikke veldig kresen. Han er mer som en gourmet og liker √• pr√∏ve forskjellige ting. Noen ganger tror jeg han er en liten matkritiker!",
          "N√•r postmannen kommer, tror jeg han tror han er en superhelt som m√• forsvare huset. Bjeffingen er p√• et ekspertniv√•, og han vifter med halen som om han er veldig stolt av innsatsen sin!",
          "Det siste eventyret v√•rt var en tur til parken, der han ble helt besatt av √• jakte p√• ekkorn. Han hoppet og sprang rundt, og det var s√• herlig √• se hvor glad han var!",
        ];
        const randomResponse =
          ownerResponses[Math.floor(Math.random() * ownerResponses.length)];
        showMessages(randomResponse, "received");
      }
      // Funksjon for √• t√∏mme chatten for Meldinger
      function clearChat() {
        const chatMessages = document.querySelector(".chat-messages");
        while (chatMessages.firstChild) {
          chatMessages.removeChild(chatMessages.firstChild);
        }
      }
      // Funksjon for √• vise fram meldinger
      function showMessages(message, type) {
        const chatMessages = document.querySelector(".chat-messages");
        const messageDiv = document.createElement("div");
        messageDiv.textContent = message;
        messageDiv.className = "message " + type;
        chatMessages.appendChild(messageDiv);
        scrollDown();
      }
      // Funksjon for √• scrolle automatisk n√•r det vises en ny melding
      function scrollDown() {
        const chatMessages = document.querySelector(".chat-messages");
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      //OPPGAVE 6 - funksjon for √• lage snakkeboble n√•r bruker trykker p√• kortet

      const dogSounds = [
        "Voff voff",
        "Grrr!",
        "Mjau??",
        "Voff!",
        "Voff voff voff",
        "WRAFF!!!",
      ];
      function dogGreeting(card) {
        if (
          event.target.id === "delete-btn" ||
          event.target.id === "chat-btn"
        ) {
          //gj√∏r at funksjonen stopper hvis bruker klikker p√• sletteknappen og chatknappen
          return;
        }

        const existingBubble = card.querySelector(".dog-greeting-bubble");
        if (existingBubble) {
          existingBubble.remove();
        }

        const dogGreetingBubble = document.createElement("div");
        dogGreetingBubble.classList.add("dog-greeting-bubble");
        dogGreetingBubble.innerHTML = `
        <div class="dog-icon">
          <img src="/dogcare-assets/ dog-icon.png" alt="dog icon">
        </div>
        <div class="dog-greeting-text">
          <p>${dogSounds[Math.floor(Math.random() * dogSounds.length)]}</p>
        </div>
        `;
        card.appendChild(dogGreetingBubble);

        if (dogGreetingBubble) {
          dogGreetingBubble.addEventListener("click", (event) => {
            event.stopPropagation(); // gj√∏r at dogGreetingCard ikke trigges igjen https://www.w3schools.com/jsref/event_stoppropagation.asp
            dogGreetingBubble.remove();
          });
        }
      }
    </script>
  </body>
</html>
